---
apiVersion: v1
kind: Namespace
metadata:
  name: ircd
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  namespace: ircd
  name: ircd-storage
spec:
  accessModes:
    - ReadWriteOnce
  storageClassName: local-path
  resources:
    requests:
      storage: 5Gi
---
apiVersion: v1
kind: Pod
metadata:
  namespace: ircd
  name: inspircd
  labels:
    run: inspircd
spec:
  volumes:
    - name: data
      persistentVolumeClaim:
        claimName: ircd-storage
  containers:
    - name: ircd
      image: xinutec/ircd:latest
      imagePullPolicy: Always
      ports:
        - containerPort: 22
      volumeMounts:
        - mountPath: /etc/inspircd/conf/secret
          name: data
          subPath: secret
---
apiVersion: v1
kind: Service
metadata:
  namespace: ircd
  name: inspircd
spec:
  type: LoadBalancer
  selector:
    run: inspircd
  ports:
    - name: clients
      protocol: TCP
      port: 6697
      targetPort: 6697
    - name: servers
      protocol: TCP
      port: 7005
      targetPort: 7005
